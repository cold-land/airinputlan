<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AirInputLan</title>
    <link rel="stylesheet" href="/pc/css/style.css">
    <script src="/pc/js/qrcode.min.js"></script>
    <script src="/pc/js/init.js"></script>
    <script src="/pc/js/app.js"></script>
    <script src="/pc/js/ai-config.js"></script>
</head>
<body>
    <!-- 主题切换按钮 -->
    <button class="theme-toggle" onclick="toggleTheme()">🌙 切换主题</button>

    <!-- AI修正按钮 -->
    <button id="ai-correction-toggle" class="ai-toggle" onclick="openAISettingsModal()">🤖 AI修正</button>

    <div id="app">
        <!-- 显控区 -->
        <div id="control-panel" class="control-panel">
            <div class="qr-container">
                <div id="qr-code">等待生成二维码...</div>
            </div>
            <div class="ip-info">
                <div class="ip-list" id="ip-list"></div>
                <div class="port-info" id="port-info"></div>
            </div>
            <div class="tips">
                <p>1. 请开放防火墙端口</p>
                <p>2. 扫码或输入 IP+端口连接</p>
            </div>
        </div>

        <!-- 历史卡片区 -->
        <div id="history-cards" class="history-cards"></div>

        <!-- 正在输入区 -->
        <div id="input-area" class="input-area">
            <div id="current-input" class="current-input"></div>
        </div>
    </div>

    <!-- AI设置模态框 -->
    <div id="ai-settings-modal" class="ai-modal hidden">
        <div class="ai-modal-content">
            <div class="ai-modal-header">
                <h2>AI 设置</h2>
                <button class="ai-modal-close" onclick="closeAISettingsModal()">×</button>
            </div>
            <div class="ai-modal-body">
                <!-- 修正模式选择 -->
                <div class="ai-config-item">
                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" name="ai-mode" id="ai-mode-manual" value="manual">
                        手动AI修正
                    </label>
                    <label style="display: inline-block;">
                        <input type="radio" name="ai-mode" id="ai-mode-auto" value="auto">
                        自动AI修正
                    </label>
                </div>

                <!-- AI 提供商选择 -->
                <div class="ai-config-item">
                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" name="ai-provider" id="ai-provider-online" value="online" onchange="toggleAIProviderConfig()">
                        在线AI（智谱AI）
                    </label>
                    <label style="display: inline-block;">
                        <input type="radio" name="ai-provider" id="ai-provider-local" value="local" onchange="toggleAIProviderConfig()">
                        本地AI（Ollama）
                    </label>
                </div>

                <!-- 本地 AI 配置 -->
                <div id="ai-local-config" class="ai-config-section hidden">
                    <div class="ai-config-item">
                        <label for="ai-local-api-url">Ollama API地址：</label>
                        <input type="text" id="ai-local-api-url" placeholder="http://localhost:11434/api/generate">
                    </div>
                    <div class="ai-config-item">
                        <label for="ai-local-model">模型名称：</label>
                        <input type="text" id="ai-local-model" placeholder="qwen3:0.6b">
                    </div>
                </div>

                <!-- 在线 AI 配置 -->
                <div id="ai-online-config" class="ai-config-section">
                    <div class="ai-config-item" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <label for="ai-online-provider" style="white-space: nowrap;">AI提供商：</label>
                        <select id="ai-online-provider" style="flex: 0 0 120px; min-width: 120px;">
                            <option value="zhipu">智谱AI</option>
                        </select>
                        <label for="ai-online-api-key" style="white-space: nowrap;">API Key：</label>
                        <input type="password" id="ai-online-api-key" placeholder="请输入智谱AI API Key" style="flex: 1; min-width: 200px;">
                    </div>
                    <div class="ai-config-item">
                        <label for="ai-online-model">模型名称：</label>
                        <input type="text" id="ai-online-model" value="glm-4.7-flash" readonly>
                    </div>
                </div>

                <!-- 通用配置 -->
                <div class="ai-config-item">
                    <label for="ai-prompt">提示词模板：</label>
                    <textarea id="ai-prompt" rows="8" placeholder="请输入提示词模板..."></textarea>
                </div>
                <div class="ai-config-actions">
                    <button onclick="exportAIConfig()">导出配置</button>
                    <button onclick="importAIConfig()">导入配置</button>
                </div>
                <div class="ai-config-warning">
                    <p><strong>⚠️ 重要说明：</strong></p>
                    <p>1. 配置仅在当前页面有效，刷新网页后配置将丢失，请务必点击"导出配置"保存配置文件</p>
                    <p>2. 在线API：依赖网络连接，需要有效的 API Key</p>
                    <p>3. 本地AI：依赖 Ollama 服务，请确保已启动</p>
                </div>
            </div>
            <div class="ai-modal-footer">
                <button class="ai-modal-cancel" onclick="closeAISettingsModal()">取消</button>
                <button class="ai-modal-save" onclick="saveAIConfig()">保存</button>
            </div>
        </div>
    </div>

</body>
</html>