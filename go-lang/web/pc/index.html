<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AirInputLan</title>
    <link rel="stylesheet" href="/pc/css/style.css">
    <script src="/pc/js/qrcode.min.js"></script>
    <script src="/pc/js/toast.js"></script>
    <script src="/pc/js/storage.js"></script>
    <script src="/pc/js/event-bus.js"></script>
    <script src="/pc/js/actions.js"></script>
    <script src="/pc/js/app.js"></script>
    <script src="/pc/js/ai-config.js"></script>
    <script src="/pc/js/init.js"></script>
</head>
<body>
    <!-- Toast 容器 -->
    <div id="toast-container"></div>
    <!-- 主题切换按钮 -->
    <button class="theme-toggle" onclick="toggleTheme()">🌙 切换主题</button>

    <!-- AI修正按钮 -->
    <button id="ai-correction-toggle" class="ai-toggle" onclick="openAISettingsModal()">🤖 AI修正</button>

    <div id="app">
        <!-- 显控区 -->
        <div id="control-panel" class="control-panel">
            <div class="qr-container">
                <div id="qr-code">等待生成二维码...</div>
            </div>
            <div class="ip-info">
                <div class="ip-list" id="ip-list"></div>
                <div class="port-info" id="port-info"></div>
            </div>
            <div class="tips">
                <p>1. 请开放防火墙端口</p>
                <p>2. 扫码或输入 IP+端口连接</p>
            </div>
        </div>

        <!-- 历史卡片区 -->
        <div id="history-cards" class="history-cards"></div>

        <!-- 正在输入区 -->
        <div id="input-area" class="input-area">
            <div id="current-input" class="current-input"></div>
        </div>
    </div>

    <!-- AI设置模态框 -->
    <div id="ai-settings-modal" class="ai-modal hidden">
        <div class="ai-modal-content">
            <div class="ai-modal-header">
                <h2>AI 设置</h2>
                <button class="ai-modal-close" onclick="closeAISettingsModal()">×</button>
            </div>
            <div class="ai-modal-body">
                <!-- 修正模式选择 -->
                <div class="ai-config-item">
                    <label style="display: inline-block; margin-right: 20px;">
                        <input type="radio" name="ai-mode" id="ai-mode-manual" value="manual">
                        手动AI修正
                    </label>
                    <label style="display: inline-block;">
                        <input type="radio" name="ai-mode" id="ai-mode-auto" value="auto">
                        自动AI修正
                    </label>
                </div>

                <!-- AI 提供商选择（单一选择） -->
                <div class="ai-config-item">
                    <label for="ai-provider">AI 提供商：</label>
                    <select id="ai-provider" onchange="handleProviderChange()">
                        <option value="zhipu">清华智谱</option>
                        <option value="iflow">阿里心流</option>
                        <option value="ollama">Ollama (本地)</option>
                    </select>
                </div>

                <!-- 智谱配置 -->
                <div id="ai-zhipu-config" class="ai-config-section hidden">
                    <div class="ai-config-item">
                        <label for="ai-zhipu-api-key">智谱 API Key：</label>
                        <input type="password" id="ai-zhipu-api-key" placeholder="请输入智谱 API Key">
                    </div>
                    <div class="ai-config-item">
                        <label for="ai-zhipu-model">模型名称：</label>
                        <select id="ai-zhipu-model">
                            <option value="glm-4-flash-250414">glm-4-flash-250414</option>
                            <option value="glm-4.7-flash">glm-4.7-flash</option>
                        </select>
                    </div>
                </div>

                <!-- 心流配置 -->
                <div id="ai-iflow-config" class="ai-config-section hidden">
                    <div class="ai-config-item">
                        <label for="ai-iflow-api-key">心流 API Key：</label>
                        <input type="password" id="ai-iflow-api-key" placeholder="请输入心流 API Key">
                    </div>
                    <div class="ai-config-item">
                        <label for="ai-iflow-model">模型名称：</label>
                        <select id="ai-iflow-model">
                            <option value="iflow-rome-30ba3b">iflow-rome-30ba3b</option>
                            <option value="qwen3-max">qwen3-max</option>
                            <option value="kimi-k2">kimi-k2</option>
                            <option value="deepseek-v3">deepseek-v3</option>
                        </select>
                    </div>
                </div>

                <!-- Ollama 配置 -->
                <div id="ai-ollama-config" class="ai-config-section hidden">
                    <div class="ai-config-item">
                        <label for="ai-ollama-api-url">API 地址：</label>
                        <input type="text" id="ai-ollama-api-url" placeholder="http://localhost:11434/api/generate">
                    </div>
                    <div class="ai-config-item">
                        <label for="ai-ollama-model">模型名称：</label>
                        <input type="text" id="ai-ollama-model" placeholder="qwen3:0.6b">
                    </div>
                </div>

                <!-- 通用配置 -->
                <div class="ai-config-item">
                    <label for="ai-prompt-template">提示词模板：</label>
                    <select id="ai-prompt-template"></select>
                </div>
                <div class="ai-config-item">
                    <label for="ai-prompt">提示词内容：</label>
                    <textarea id="ai-prompt" rows="8" placeholder="请输入或修改提示词模板..."></textarea>
                </div>
                <div class="ai-config-actions">
                    <button onclick="exportAIConfig()">导出配置</button>
                    <button onclick="importAIConfig()">导入配置</button>
                </div>
            </div>
            <div class="ai-modal-footer">
                <button class="ai-modal-clear" onclick="restoreDefaultConfig()">恢复默认配置</button>
                <button class="ai-modal-cancel" onclick="closeAISettingsModal()">取消</button>
                <button class="ai-modal-save" onclick="saveAIConfig()">保存</button>
            </div>
        </div>
    </div>

</body>
</html>